<!DOCTYPE html>
<html id="wrapper">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script type="text/javascript">
        var uname = sessionStorage.getItem("userName");//global user name, used in most functions
        var password = sessionStorage.getItem("userPassword");//global user password, used in most functions
        function saveColor() {//function to save colors to local storage and to array, called by form submit
            for (var i = 0; i < 4; i++) {//loop to save users colors in local storage
                localStorage.setItem(uname + password + "clr" + i, document.getElementById("chosenColor" + parseInt(1 + i)).value);
            }
        }
        function saveSpeed() {//function to save user speed, called by form submit
            localStorage.setItem(uname + password + "speed", document.getElementById("ChosenSpeed").value);
        }
        function initVal() {//called on body load, welcomes player,
            //and if it is a recurring player initializes the values to values chosen last time that player played a game
            document.getElementById("welcome").innerHTML += uname[0].toUpperCase() + "!";//welcoming player by his name initial
            if (parseInt(localStorage.getItem(sessionStorage.getItem("userName") + sessionStorage.getItem("userPassword") + "gameCount")) > 0) {//if played more than once
                for (var i = 1; i <= 4; i++) {
                    document.getElementById("chosenColor" + i).value = localStorage.getItem(uname + password + "clr" + (parseInt(i) - 1));//set the colors
                }
                document.getElementById("ChosenSpeed").value = localStorage.getItem(uname + password + "speed");//set the speed
            }
        }
        function ScoresPage() {//aside func for player to see max score
            var max = localStorage.getItem(uname + password + "HighestScore");
            document.getElementById("gameScores").innerHTML = max;//print highest score
        }
        function getFileDetails(e) {//function to save winning music
            var files = e.target.files;
            localStorage.setItem(uname + password + "soundValue", files[0].name);

            for (var i = 0, file; file = files[i]; i++) {
                var reader = new FileReader();
                if (file.type.match("audio*")) {
                    reader.onload = function (e) {
                        var x = e.target.result;
                        localStorage.setItem(uname + password + "sound", x);
                    }
                    reader.readAsDataURL(file);
                }
            }
        }
        function nextPage() {//function occurs on submit, saves colors and speed. call to next page happens automatically onsubmit
            saveColor();//saves the colors
            saveSpeed();//saves the speed
        }
    </script>
    <link href="styles.css" rel="stylesheet" />
</head>
<body onload="initVal(); ScoresPage()">
    <section>
        <header>
            <div class="text">Welcome to Bomb Bubbles!</div>
        </header>
        <aside id="rAside">

            <nav>
                <p id="welcome" style="font-size:50px; float:none; font-family:cursive;">Hi, </p>

                <details>
                    Choose your favorite colors, the speed you will like to play, and the sound when you pop a bubble.
                    Don't worry- you can always change your choice later...
                </details><br />
                <br />  
                <h3 style="padding:0px; margin:0px;">Highest Score: </h3>
                <h2  id="gameScores"></h2>

            </nav>
        </aside>
        <article>
            <form onsubmit="nextPage()" action="BubblesGame.html">
                <!--form to simplify required fields- force user to fill them in, and onsubmit -->
                <label>Enter Colors for Game</label>
                <br />
                <br /><!--if user chose a color, disable that button-->
                <input type="color" name="colors" id="chosenColor1" onchange="document.activeElement.disabled = true;" value="#ff1700" required />
                <input type="color" name="colors" id="chosenColor2" onchange="document.activeElement.disabled = true;" value="#ff8100" required />
                <input type="color" name="colors" id="chosenColor3" onchange="document.activeElement.disabled = true;" value="#28ff00" required />
                <input type="color" name="colors" id="chosenColor4" onchange="document.activeElement.disabled = true;" value="#0020ff" required />
                <br />
                <br />
                <label>Enter Speed</label>
                <br />
                <input type="number" id="ChosenSpeed" max="7" min="1" required />
                <br />
                <br />
                <label>Enter Sound</label>
                <br />
                <input type="file" style="margin-left:15%;" id="files1" accept="audio/*" onchange="getFileDetails(event)" />
                <br />
                <br />
                <input class="button" style="height:100px; width: 300px;" type="submit" value="Ready for the Game?" />
            </form>
        </article>
        <footer>created by Batsheva Rich</footer>

    </section>
</body>
</html>